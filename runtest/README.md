# 跑步姿态分析系统

一个基于计算机视觉的跑步姿态分析系统，使用 MediaPipe 进行人体姿态检测，提供详细的生物力学分析和个性化改进建议。

## 功能特点

### 🏃‍♂️ 核心分析功能
- **步态分析**: 自动检测步频、步幅和步态周期
- **关节角度**: 实时计算膝关节、髋关节角度变化
- **姿态评估**: 分析身体前倾角度和整体跑步姿态
- **足部着地**: 识别左右脚着地模式和时机

### 📊 可视化展示
- **实时图表**: 步态周期和关节角度变化图
- **视频回放**: 上传视频的在线播放功能
- **数据对比**: 与理想数值范围的对比分析

### 🎯 个性化建议
- **步频优化**: 基于160-180步/分钟的理想范围
- **姿态改进**: 针对身体前倾和关节角度的具体建议
- **伤病预防**: 基于生物力学原理的风险提示

## 技术架构

### 后端技术栈
- **Python 3.8+**: 主要开发语言
- **MediaPipe**: Google开源的姿态检测框架
- **OpenCV**: 视频处理和计算机视觉
- **Flask**: Web应用框架
- **NumPy/SciPy**: 数值计算和信号处理
- **Matplotlib**: 数据可视化

### 前端技术栈
- **HTML5**: 现代Web标准
- **Bootstrap 5**: 响应式UI框架
- **JavaScript**: 交互逻辑和AJAX请求
- **Chart.js**: 图表展示（通过Matplotlib生成）

## 安装与运行

### 环境要求
- Python 3.8 或更高版本
- 推荐使用 conda 或 virtualenv 虚拟环境
- 支持 macOS、Linux 和 Windows

### 快速开始

1. **克隆项目**
```bash
git clone <repository-url>
cd runtest
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **启动Web应用**
```bash
python app.py
```

4. **访问应用**
打开浏览器访问: http://localhost:8888

### 命令行使用

对于批量处理或自动化分析，可以使用命令行工具：

```bash
# 基本分析
python main.py video.mp4

# 保存结果到文件
python main.py video.mp4 --output analysis.json

# 详细输出
python main.py video.mp4 --output analysis.json --verbose
```

## 使用指南

### Web界面使用

1. **上传视频**
   - 支持 MP4、AVI、MOV 等常见视频格式
   - 推荐视频时长 10-60 秒
   - 确保人物清晰可见，侧面拍摄效果最佳

2. **分析过程**
   - 系统自动检测人体关键点
   - 实时处理每一帧图像
   - 计算生物力学指标

3. **结果查看**
   - 视频回放功能
   - 详细的数值指标
   - 可视化图表展示
   - 个性化改进建议

### 最佳实践

#### 视频拍摄建议
- **拍摄角度**: 侧面90度角拍摄
- **拍摄距离**: 保持2-3米距离，确保全身入镜
- **背景环境**: 选择简洁背景，避免复杂场景
- **光线条件**: 充足的自然光或人工照明
- **服装要求**: 穿着贴身运动服，避免宽松衣物

#### 分析准确性
- **跑步状态**: 保持正常跑步速度和姿态
- **视频质量**: 推荐1080p以上分辨率
- **拍摄稳定**: 使用三脚架固定拍摄设备
- **跑步时长**: 至少包含10-15个完整步态周期

## 分析指标说明

### 主要指标

| 指标 | 说明 | 理想范围 |
|-----|------|----------|
| 步频 | 每分钟步数 | 160-180 步/分钟 |
| 步幅 | 相对步幅长度 | 因人而异 |
| 膝关节角度 | 膝关节弯曲角度 | 140-170 度 |
| 身体前倾角度 | 躯干前倾角度 | 5-15 度 |

### 建议类型

- **步频调整**: 过低或过高的步频优化建议
- **姿态改进**: 身体姿态和关节角度优化
- **技术要点**: 跑步技术的具体改进点
- **伤病预防**: 基于分析结果的风险提示

## 项目结构

```
runtest/
├── app.py                 # Flask Web应用主程序
├── main.py               # 命令行工具
├── pose_detector.py      # MediaPipe姿态检测模块
├── gait_analyzer.py      # 步态分析和建议生成
├── requirements.txt      # 项目依赖
├── CLAUDE.md            # 开发者文档
├── README.md            # 项目说明
├── templates/           # HTML模板
│   └── index.html       # 主页面
├── uploads/             # 上传视频存储
├── results/             # 分析结果存储
└── static/              # 静态资源
    ├── css/
    └── js/
```

## 核心模块

### pose_detector.py
- `RunningPoseDetector`: 主要的姿态检测类
- 处理视频文件，提取关键点坐标
- 计算关节角度和身体位置

### gait_analyzer.py
- `GaitAnalyzer`: 步态分析引擎
- 检测脚部着地时机
- 计算步频、步幅等指标
- 生成个性化建议

### app.py
- Flask Web应用
- 处理文件上传和分析请求
- 生成可视化图表
- 提供RESTful API

## 技术细节

### 姿态检测
使用 MediaPipe Pose 模型，可以检测33个人体关键点：
- 头部: 鼻子、眼睛、耳朵
- 躯干: 肩膀、肘部、手腕、髋部
- 腿部: 膝盖、脚踝、脚部关键点

### 步态分析算法
1. **足部着地检测**: 基于脚踝垂直位置变化
2. **步频计算**: 统计单位时间内的步数
3. **步幅估算**: 基于髋部中心点移动距离
4. **关节角度**: 使用向量几何计算三点角度

### 数据处理
- 信号滤波和噪声去除
- 峰值检测算法识别关键事件
- 时间序列分析处理运动数据

## 常见问题

### Q: 分析结果不准确怎么办？
A: 检查视频拍摄角度、光线条件和人物清晰度。推荐侧面90度角拍摄，确保全身清晰可见。

### Q: 支持哪些视频格式？
A: 支持 MP4、AVI、MOV、WMV 等常见格式。推荐使用 MP4 格式以获得最佳兼容性。

### Q: 视频文件过大怎么办？
A: 建议视频时长控制在1分钟以内，分辨率1080p即可。过大的文件会增加处理时间。

### Q: 可以分析多人跑步吗？
A: 目前版本只支持单人分析。请确保视频中只有一个人在跑步。

## 贡献指南

欢迎贡献代码和提出改进建议！

### 开发环境设置
```bash
# 克隆项目
git clone <repository-url>
cd runtest

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 运行测试
python -m pytest tests/  # 如果有测试文件
```

### 提交规范
- 使用清晰的commit message
- 确保代码通过现有测试
- 添加必要的文档说明

## 版本历史

### v1.0.0 (2025-07-07)
- 初始版本发布
- 基础姿态检测功能
- Web界面和命令行工具
- 步态分析和建议生成

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。

## 支持与反馈

如果您在使用过程中遇到问题或有改进建议，请通过以下方式联系：

- 提交 GitHub Issue
- 发送邮件到项目维护者
- 参与项目讨论

---

**免责声明**: 本系统仅供参考，不能替代专业的运动指导。如有运动伤病，请咨询专业医生或运动康复师。